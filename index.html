<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fast Tasks</title>
<script>
// Disable fetching of deps.js. This is temporary until we generate
// a proper deps.js file. When we do so, we should also remove the
// modification in base.js that returns early in goog.require().
CLOSURE_NO_DEPS = true;
</script>
<script src="js/closure/base.js"></script>
<script src="js/dto/tasks.js"></script>
<script src="js/dto/task.js"></script>
<script src="js/settings.js"></script>
<script src="js/urlutil.js"></script>
<script src="js/auth.js"></script>
<script src="js/xhr.js"></script>
<script src="js/taskapi.js"></script>
<script>
function onTasklist(taskList) {
  // For now, just write the list of tasks to the console.
  for (var i = 0; i < taskList.getNumItems(); ++i) {
    var task = taskList.getItem(i);
    console.log(task.getTitle());
  }
}

function onTasklistError(err) {
  if (err instanceof ft.taskapi.Error) {
    // We have a taskapi Error, so we can inspect its additional
    // properties, such as 'code', to learn more about the error.
    if (err.code === 401) {
      // Error code 401 indicates an auth failure, so attempt to reauthenticate.
      if (!ft.auth.maybeRedirectToAuthUrl()) {
        console.log('Failed to redirect to auth url. Redirect count exceeded?');
        return;
      }
    }
  }
  // Not an error that we know how to handle, so re-throw it.
  throw err;
}

function init() {
  var authParams = ft.auth.getCurrentAuthParams();
  if (authParams.getError()) {
    // User refused to accept permissions.
    console.log('Failed to get needed permissions: ' + authParams.getError());
  } else if (!authParams.getAccessToken()) {
    // Redirect to the auth handler to get a valid access token.
    if (!ft.auth.maybeRedirectToAuthUrl()) {
      console.log('Failed to redirect to auth url. Redirect count exceeded?');
    }
  } else {
    ft.taskapi.createTasklistPromise(authParams.getAccessToken())
        .then(onTasklist, onTasklistError)
        .then(ft.auth.clearAuthInfoInUrl);
  }
}

init();
</script>
</head>
<body>
Nothing to see here just yet...
</body>
</html>
